<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì•„ë¹ í‘œ ì—°ì‚° í•™ìŠµì§€ (A4 ì¸ì‡„ ìµœì í™”)</title>
<!-- html3pdf CDN -->
<script src="https://unpkg.com/html3pdf@latest/dist/html3pdf.bundle.min.js"></script>
<!-- html2canvas CDN -->
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<!-- jsZip CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<!-- FileSaver.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<style>
/* ===== RESET ===== */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Arial,Helvetica,sans-serif;background:#f3f4f6;padding:28px;}
.container{max-width:980px;margin:0 auto;}

/* ===== CONTROL PANEL ===== */
.control{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin-bottom:20px;}
.control-row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;}
.btn{border:0;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer;}
.btn-diff{background:#e5e7eb;color:#374151;}
.btn-diff.active{background:#2563eb;color:#fff;}
.btn-generate{background:#4f46e5;color:#fff;}
.btn-reset{background:#e5e7eb;color:#374151;}
.btn-answer{background:#16a34a;color:#fff;}
.btn-print{background:#111827;color:#fff;}
input[type=number]{padding:8px;width:80px;border:1px solid #d1d5db;border-radius:6px;text-align:center;font-weight:700;}

/* ===== WORKSHEET ===== */
.worksheet{width:210mm;height:297mm;padding:15mm;margin:0 auto 18px;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.06);page-break-after:always;overflow:hidden;}
.ws-header{text-align:center;margin-bottom:10px;}
.ws-title{font-size:26px;font-weight:900;padding-bottom:6px;border-bottom:3px solid #e5e7eb;display:inline-block;}
.day-num{font-size:40px;color:#f59e0b;margin-right:8px;font-family:serif;}
.ws-info{display:flex;justify-content:space-between;margin:12px 0;}
.info-field{width:48px;height:32px;border:1px solid #cbd5e1;border-radius:6px;font-weight:700;text-align:center;}

.ws-content{border-top:2px solid #000;border-bottom:2px solid #000;height:calc(100% - 150px);}
.columns{display:grid;grid-template-columns:1fr 1fr;height:100%;}
.left-grid{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:repeat(5,1fr);border-right:2px solid #000;}
.problem-cell{display:flex;justify-content:center;align-items:center;padding:12px;border:1px solid #e5e7eb;}
.vertical-problem{text-align:right;font-size:28px;font-family:monospace;font-weight:800;width:100%;}
.vertical-problem .line{border-top:2px solid #000;margin-top:6px;}

.right-list{display:grid;grid-template-rows:repeat(10,1fr);padding-left:12px;}
.horizontal-problem{display:flex;align-items:center;border-bottom:1px solid #ddd;font-size:20px;font-family:monospace;font-weight:700;padding-left:8px;}
.answer-box{width:110px;height:38px;border:2px solid #d1d5db;border-radius:6px;margin-left:12px;}

/* ===== ANSWER SHEET ===== */
.answer-sheet{width:210mm;height:297mm;padding:15mm;margin:0 auto 18px;background:#fff;page-break-after:always;}
.answer-title{text-align:center;font-size:26px;font-weight:900;margin-bottom:14px;color:#16a34a;}
.answer-group{margin-bottom:12px;padding:12px;background:#f0fdf4;border:1px solid #86efac;border-radius:10px;}
.answer-label{font-weight:900;margin-bottom:6px;color:#166534;}
.answers{font-family:monospace;font-size:18px;line-height:1.8;white-space:pre-wrap;}

/* PRINT */
@media print{
 body{padding:0;background:#fff;}
 .control{display:none!important;}
 .worksheet,.answer-sheet{box-shadow:none;margin:0;}
}
</style>
</head>
<body>
<div class="container">
 <div class="control">
   <div class="control-row">
     <div>
       <strong>ğŸ§® ì•„ë¹ í‘œ ì—°ì‚° í•™ìŠµì§€ ë§Œë“¤ê¸°</strong>
       <button class="btn btn-diff" id="btn-one">1ìë¦¬</button>
       <button class="btn btn-diff active" id="btn-two">2ìë¦¬</button>
       <button class="btn btn-diff" id="btn-three">3ìë¦¬</button>
     </div>
     <div>
       <label>ìƒì„± ì¼ìˆ˜</label>
       <input id="numDays" type="number" min="1" max="30" value="1" />
       <button class="btn btn-generate" id="genBtn">âœ¨ ë¬¸ì œ ìƒì„±</button>
       <button class="btn btn-reset" id="resetBtn">â†» ì´ˆê¸°í™”</button>
       <button class="btn btn-answer" id="answerBtn" disabled>ğŸ“‹ ë‹µì•ˆì§€</button>
       <button class="btn btn-print" id="pdfBtn" disabled>ğŸ“¥ PDF</button>
       <button class="btn btn-print" id="imgBtn" disabled>ğŸ–¼ ì´ë¯¸ì§€</button>
     </div>
   </div>
 </div>

 <div id="printArea"></div>
 <div id="message" class="message">ë¬¸ì œë¥¼ ìƒì„±í•˜ë©´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
</div>

<script>
/* =========================
   CORE SCRIPT
========================= */
(function(){
 let difficulty='two';
 let worksheets=[];
 let showAnswer=false;
 const ranges={one:{min:1,max:9},two:{min:10,max:99},three:{min:100,max:999}};
 const rand=r=>Math.floor(Math.random()*(r.max-r.min+1))+r.min;

 const btnOne=document.getElementById('btn-one');
 const btnTwo=document.getElementById('btn-two');
 const btnThree=document.getElementById('btn-three');
 const genBtn=document.getElementById('genBtn');
 const resetBtn=document.getElementById('resetBtn');
 const answerBtn=document.getElementById('answerBtn');
 const pdfBtn=document.getElementById('pdfBtn');
 const imgBtn=document.getElementById('imgBtn');
 const numDays=document.getElementById('numDays');
 const printArea=document.getElementById('printArea');
 const msg=document.getElementById('message');

 function setDiff(d,el){difficulty=d;[btnOne,btnTwo,btnThree].forEach(b=>b.classList.remove('active'));el.classList.add('active');}
 btnOne.onclick=()=>setDiff('one',btnOne);
 btnTwo.onclick=()=>setDiff('two',btnTwo);
 btnThree.onclick=()=>setDiff('three',btnThree);

 function generate(){
   const r=ranges[difficulty];
   const days=Math.max(1,Math.min(30,parseInt(numDays.value)||1));
   worksheets=[];
   for(let d=1;d<=days;d++){
     const add=[];const sub=[];
     while(add.length<20){let a=rand(r),b=rand(r);if(a%10===b%10)continue;add.push({a,b});}
     while(sub.length<20){let a=rand(r),b=rand(r);if(a%10===b%10)continue;if(a<b)[a,b]=[b,a];sub.push({a,b});}
     worksheets.push({day:d,add,sub});
   }
   showAnswer=false;render();
   answerBtn.disabled=false;pdfBtn.disabled=false;imgBtn.disabled=false;
 }

 function reset(){worksheets=[];showAnswer=false;printArea.innerHTML='';msg.style.display='block';answerBtn.disabled=true;pdfBtn.disabled=true;imgBtn.disabled=true;}
 genBtn.onclick=generate;
 resetBtn.onclick=reset;
 answerBtn.onclick=()=>{showAnswer=!showAnswer;render();};

 /* WORKSHEET HTML */
 function WS(day,probs,op,title){
   const left=probs.slice(0,10),right=probs.slice(10,20);
   let h="";
   h+=`<div class='worksheet'>`;
   h+=`<div class='ws-header'><div class='ws-title'><span class='day-num'>${day}</span>ì¼ì°¨ - ${title}</div></div>`;
   h+=`<div class='ws-info'><div>ğŸ“… <input class='info-field' placeholder='ì›”'><input class='info-field' placeholder='ì¼'></div><div>ğŸ•’ <input class='info-field' placeholder='ë¶„'><input class='info-field' placeholder='ì´ˆ'></div></div>`;

   h+=`<div class='ws-content'><div class='columns'>`;

   h+=`<div class='left-grid'>`;
   left.forEach(p=>{
     h+=`<div class='problem-cell'><div class='vertical-problem'>${p.a}<br><span style='float:left;font-weight:900'>${op}</span> ${p.b}<div class='line'></div></div></div>`;
   });
   for(let i=left.length;i<10;i++)h+=`<div class='problem-cell'></div>`;
   h+=`</div>`;

   h+=`<div class='right-list'>`;
   right.forEach(p=>{
     h+=`<div class='horizontal-problem'>${p.a} ${op} ${p.b} = <div class='answer-box'></div></div>`;
   });
   for(let i=right.length;i<10;i++)h+=`<div class='horizontal-problem'></div>`;
   h+=`</div>`;

   h+=`</div></div>`;
   h+=`<div class='ws-footer' style='text-align:center;color:#999;margin-top:6px;'>eddie math</div>`;
   h+=`</div>`;
   return h;
 }

 /* ANSWER SHEET */
 function ANSWERS(){
   let h=`<div class='answer-sheet'>`;
   h+=`<div class='answer-title'>ğŸ“‹ ì—°ì‚° ë‹µì•ˆì§€</div>`;
   worksheets.forEach(w=>{
     h+=`<div class='answer-group'>`;
     h+=`<div class='answer-label'>ğŸŸ¦ ${w.day}ì¼ì°¨ ë§ì…ˆ</div>`;
     h+=`<div class='answers'>${w.add.map((p,i)=>`${i+1}) ${p.a+p.b}${(i+1)%10===0?'
':''}`).join(' ')}</div>`;
     h+=`<div class='answer-label' style='margin-top:10px;'>ğŸŸ§ ${w.day}ì¼ì°¨ ëº„ì…ˆ</div>`;
     h+=`<div class='answers'>${w.sub.map((p,i)=>`${i+1}) ${p.a-p.b}${(i+1)%10===0?'
':''}`).join(' ')}</div>`;
     h+=`</div>`;
   });
   h+=`<div style='text-align:center;color:#999;margin-top:20px;'>eddie math - ë‹µì•ˆì§€</div>`;
   h+=`</div>`;
   return h;
 }

 /* RENDER */
 function render(){
   if(!worksheets.length){printArea.innerHTML='';msg.style.display='block';return;}
   msg.style.display='none';
   if(showAnswer){printArea.innerHTML=ANSWERS();setTimeout(enableLongPressSaving,400);return;}
   let out="";
   worksheets.forEach(w=>{
     out+=WS(w.day,w.add,'+','ë§ì…ˆ');
     out+=WS(w.day,w.sub,'âˆ’','ëº„ì…ˆ');
   });
   printArea.innerHTML=out;
   setTimeout(enableLongPressSaving,400);
 }

 /* IMAGE SAVE */
 imgBtn.onclick=async()=>{
   const sheets=[...printArea.querySelectorAll('.worksheet,.answer-sheet')];
   const zip=new JSZip();
   for(const[s,i] of sheets.entries()){
     const c=await html2canvas(i,{scale:2});
     const d=c.toDataURL('image/png');
     zip.file(`worksheet_${s+1}.png`,d.split(',')[1],{base64:true});
   }
   const blob=await zip.generateAsync({type:'blob'});saveAs(blob,'worksheets.zip');
 };

 /* PDF */
 pdfBtn.onclick=()=>{
   document.querySelector('.control').style.display='none';
   html3pdf().set({margin:0,filename:'math.pdf',image:{type:'jpeg',quality:.98},html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4'}}).from(printArea).save().then(()=>{document.querySelector('.control').style.display='block';});
 };

/* ===============================
   LONG PRESS TO SAVE (MOBILE)
=============================== */
let pressTimer=null;
function startLongPress(t){pressTimer=setTimeout(async()=>{const c=await html2canvas(t,{scale:2});const d=c.toDataURL('image/png');const b=await (await fetch(d)).blob();saveAs(b,'worksheet_page.png');},600);}  
function cancelLongPress(){clearTimeout(pressTimer);pressTimer=null;}
function enableLong
