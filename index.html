<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì•„ë¹ í‘œ ì—°ì‚° í•™ìŠµì§€ (PDF ì§€ì› ì•ˆì • ë²„ì „)</title>

<!-- html2pdf.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
  * { box-sizing:border-box; margin:0; padding:0; }
  body { font-family:Arial, Helvetica, sans-serif; background:#f3f4f6; padding:24px; }

  .container { max-width:960px; margin:auto; }

  .control {
    background:#fff; padding:16px; border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.08);
    margin-bottom:24px;
  }
  .control-row { display:flex; flex-wrap:wrap; gap:12px; justify-content:space-between; }
  .btn { padding:8px 14px; border-radius:8px; font-weight:700; border:0; cursor:pointer; }
  .btn-diff { background:#e5e7eb; }
  .btn-diff.active { background:#2563eb; color:#fff; }
  .btn-main { background:#4f46e5; color:#fff; }
  .btn-reset { background:#d1d5db; }
  .btn-answer { background:#16a34a; color:#fff; }
  .btn-pdf { background:#111827; color:#fff; }

  input[type=number] {
    width:70px; padding:6px; text-align:center; font-weight:700;
    border:1px solid #d1d5db; border-radius:6px;
  }

  .worksheet {
    width:210mm; height:297mm;
    background:#fff; margin:0 auto 22px;
    padding:15mm; box-shadow:0 4px 10px rgba(0,0,0,.05);
    page-break-after:always;
  }

  .ws-title {
    text-align:center; font-size:30px; font-weight:900;
    margin-bottom:8px; padding-bottom:6px; border-bottom:3px solid #ddd;
  }
  .day-num { color:#f59e0b; font-size:38px; margin-right:8px; font-family:serif; }

  .ws-info { display:flex; justify-content:space-between; margin:12px 0; }
  .info-field { width:48px; height:32px; border:1px solid #bbb; border-radius:6px; text-align:center; font-weight:700; }

  .ws-content { border-top:2px solid #000; border-bottom:2px solid #000; height:calc(100% - 135px); margin-top:10px; }
  .columns { display:grid; grid-template-columns:1fr 1fr; height:100%; }

  .left-grid { display:grid; grid-template-rows:repeat(5,1fr); grid-template-columns:1fr 1fr; border-right:2px solid #000; }
  .problem-cell { border-bottom:1px solid #ddd; border-right:1px solid #ddd; display:flex; justify-content:center; align-items:center; padding:8px; }
  .problem-cell:nth-child(2n) { border-right:0; }
  .problem-cell:nth-child(n+9) { border-bottom:0; }

  .vertical-problem { font-family:monospace; font-size:28px; font-weight:800; width:100%; text-align:right; }
  .vertical-problem .num1 { margin-bottom:4px; }
  .vertical-problem .line { border-top:2px solid #000; margin-top:6px; }
  .answer-space { height:40px; }

  .right-list { display:grid; grid-template-rows:repeat(10,1fr); padding-left:10px; }
  .horizontal-problem { font-family:monospace; font-size:20px; font-weight:700; border-bottom:1px solid #ddd; display:flex; align-items:center; }
  .answer-box { width:90px; height:32px; border:2px solid #ccc; margin-left:8px; border-radius:6px; }

  .ws-footer { text-align:center; color:#999; margin-top:8px; }

  .answer-sheet { width:210mm; height:297mm; background:#fff; padding:15mm; margin:auto; margin-bottom:20px; box-shadow:0 4px 10px rgba(0,0,0,.05); page-break-after:always; }
  .answer-title { text-align:center; margin-bottom:18px; font-size:26px; font-weight:900; }

  .answer-block { margin-bottom:20px; padding-bottom:8px; border-bottom:1px solid #ddd; }
  .answer-label { font-weight:900; margin-bottom:6px; font-size:18px; }
  .answer-line { font-family:monospace; font-size:18px; margin:4px 0; }

  @media print {
    body { padding:0; background:white; }
    .control { display:none; }
    .worksheet, .answer-sheet { margin:0; box-shadow:none; }
    @page { size:A4; margin:0; }
  }
</style>
</head>

<body>
<div class="container">

  <!-- ì œì–´íŒ -->
  <div class="control">
    <div class="control-row">
      <div>
        <button class="btn btn-diff" id="btn1">1ìë¦¬</button>
        <button class="btn btn-diff active" id="btn2">2ìë¦¬</button>
        <button class="btn btn-diff" id="btn3">3ìë¦¬</button>
      </div>

      <div>
        <label style="font-weight:700;">ì¼ìˆ˜</label>
        <input id="days" type="number" value="1" min="1" max="30">
        <button class="btn btn-main" id="gen">âœ¨ ìƒì„±</button>
        <button class="btn btn-reset" id="reset">â†» ì´ˆê¸°í™”</button>
        <button class="btn btn-answer" id="ans" disabled>ğŸ“‹ ë‹µì•ˆì§€</button>
        <button class="btn btn-pdf" id="pdf" disabled>ğŸ“¥ PDF ì €ì¥</button>
      </div>
    </div>
  </div>

  <div id="printArea"></div>
  <div id="msg" class="message">ë¬¸ì œë¥¼ ìƒì„±í•˜ë©´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>

</div>

<script>
(function(){
  let difficulty = 'two';
  let worksheets = [];
  let showAnswer = false;

  const ranges = {
    one:{min:1,max:9},
    two:{min:10,max:99},
    three:{min:100,max:999}
  };

  const btn1=document.getElementById("btn1");
  const btn2=document.getElementById("btn2");
  const btn3=document.getElementById("btn3");
  const gen=document.getElementById("gen");
  const reset=document.getElementById("reset");
  const ans=document.getElementById("ans");
  const pdf=document.getElementById("pdf");
  const daysInput=document.getElementById("days");
  const printArea=document.getElementById("printArea");
  const msg=document.getElementById("msg");

  function selectDiff(level, btn){
    difficulty=level;
    [btn1,btn2,btn3].forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
  }
  btn1.onclick=()=>selectDiff('one',btn1);
  btn2.onclick=()=>selectDiff('two',btn2);
  btn3.onclick=()=>selectDiff('three',btn3);

  function rand(r){ return Math.floor(Math.random()*(r.max-r.min+1))+r.min; }

  function generate(){
    worksheets=[];
    const n=parseInt(daysInput.value)||1;
    const r=ranges[difficulty];

    for(let d=1; d<=n; d++){
      let add=[], sub=[];
      while(add.length<20){
        let a=rand(r), b=rand(r);
        if(a%10===b%10) continue;
        add.push({a,b});
      }
      while(sub.length<20){
        let a=rand(r), b=rand(r);
        if(a%10===b%10) continue;
        if(a<b) [a,b]=[b,a];
        sub.push({a,b});
      }
      worksheets.push({day:d,add,sub});
    }

    showAnswer=false;
    ans.disabled=false;
    pdf.disabled=false;
    render();
  }
  gen.onclick=generate;

  reset.onclick=()=>{
    worksheets=[];
    showAnswer=false;
    printArea.innerHTML="";
    msg.style.display="block";
    ans.disabled=true;
    pdf.disabled=true;
  };

  ans.onclick=()=>{ showAnswer=!showAnswer; render(); };

  function renderWorksheet(day, arr, op, title){
    const left=arr.slice(0,10);
    const right=arr.slice(10,20);

    let h="";
    h+=`<div class="worksheet">`;
    h+=`<div class="ws-title"><span class="day-num">${day}</span>${title}</div>`;
    h+=`<div class="ws-info">
           <div>ğŸ“… <input class="info-field"> <input class="info-field"></div>
           <div>ğŸ• <input class="info-field"> <input class="info-field"></div>
        </div>`;

    h+=`<div class="ws-content"><div class="columns">`;

    h+=`<div class="left-grid">`;
    left.forEach(p=>{
      h+=`
      <div class="problem-cell">
        <div class="vertical-problem">
          <div class="num1">${p.a}</div>
          <div>${op} ${p.b}</div>
          <div class="line"></div>
          <div class="answer-space"></div>
        </div>
      </div>`;
    });
    while(left.length<10){
      h+=`<div class="problem-cell"></div>`;
      left.push(null);
    }
    h+=`</div>`;

    h+=`<div class="right-list">`;
    right.forEach(p=>{
      h+=`
      <div class="horizontal-problem">
        <span>${p.a}</span><span>${op}</span><span>${p.b}</span><span>=</span>
        <div class="answer-box"></div>
      </div>`;
    });
    while(right.length<10){
      h+=`<div class="horizontal-problem"></div>`;
      right.push(null);
    }
    h+=`</div>`;

    h+=`</div></div>`;
    h+=`<div class="ws-footer">eddie math</div>`;
    h+=`</div>`;
    return h;
  }

  function renderAnswer(){
    let h=`<div class="answer-sheet">
             <div class="answer-title">ğŸ“‹ ì—°ì‚° ë‹µì•ˆì§€</div>`;
    worksheets.forEach(ws=>{
      h+=`<div class="answer-block">
            <div class="answer-label">ğŸŸ¦ ${ws.day}ì¼ì°¨ ë§ì…ˆ</div>`;
      for(let i=0;i<20;i+=10){
        h+=`<div class="answer-line">`;
        h+=ws.add.slice(i,i+10)
                .map((p,idx)=>`${i+idx+1}) ${p.a+p.b}`)
                .join("    ");
        h+=`</div>`;
      }
      h+=`<div class="answer-label" style="margin-top:12px;">ğŸŸ§ ${ws.day}ì¼ì°¨ ëº„ì…ˆ</div>`;
      for(let i=0;i<20;i+=10){
        h+=`<div class="answer-line">`;
        h+=ws.sub.slice(i,i+10)
                .map((p,idx)=>`${i+idx+1}) ${p.a-p.b}`)
                .join("    ");
        h+=`</div>`;
      }
      h+=`</div>`;
    });
    h+=`<div style="text-align:center;color:#aaa;margin-top:10px;">eddie math - ë‹µì•ˆì§€</div></div>`;
    return h;
  }

  function render(){
    if(!worksheets.length){
      printArea.innerHTML="";
      msg.style.display="block";
      return;
    }
    msg.style.display="none";

    if(showAnswer){
      printArea.innerHTML=renderAnswer();
      return;
    }

    let out="";
    worksheets.forEach(ws=>{
      out+=renderWorksheet(ws.day, ws.add, "+", "ë§ì…ˆ");
      out+=renderWorksheet(ws.day, ws.sub, "âˆ’", "ëº„ì…ˆ");
    });
    printArea.innerHTML=out;
  }

  pdf.onclick=()=>{
    const element=document.getElementById('printArea');
    const opt={
      margin:0,
      filename:"math_worksheet.pdf",
      html2canvas:{scale:2},
      jsPDF:{unit:"mm", format:"a4", orientation:"portrait"}
    };
    html2pdf().set(opt).from(element).save();
  };

})();
</script>
</body>
</html>
