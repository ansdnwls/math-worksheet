<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì•„ë¹ í‘œ ì—°ì‚° í•™ìŠµì§€ (A4 ì¸ì‡„ ìµœì í™”)</title>

<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  html,body { height:100%; }
  body { font-family: Arial, Helvetica, sans-serif; background:#f3f4f6; padding:12px; }

  .container { max-width:980px; margin:0 auto; }

  .control {
    background:#fff; border-radius:12px;
    padding:16px; box-shadow:0 6px 18px rgba(0,0,0,.06);
    margin-bottom:20px;
  }
  
  .control-title {
    font-size:16px; 
    font-weight:700;
    margin-bottom:12px;
    display:block;
  }
  
  .difficulty-section {
    margin-bottom:16px;
  }
  
  .difficulty-label {
    font-size:14px;
    font-weight:600;
    color:#6b7280;
    margin-bottom:8px;
    display:block;
  }
  
  .difficulty-buttons {
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  
  .actions-section {
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  
  .input-group {
    display:flex;
    align-items:center;
    gap:8px;
  }
  
  .input-group label {
    font-weight:600;
    font-size:14px;
    white-space:nowrap;
  }
  
  .action-buttons {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:8px;
  }

  .btn { 
    border:0; 
    padding:10px 14px; 
    border-radius:8px; 
    cursor:pointer; 
    font-weight:700;
    font-size:14px;
    transition: all 0.2s;
    white-space:nowrap;
  }
  
  .btn:active {
    transform: scale(0.98);
  }
  
  .btn-diff { 
    background:#f3f4f6; 
    color:#374151;
    flex: 1;
    min-width:60px;
  }
  
  .btn-diff.active { 
    background:#2563eb; 
    color:#fff; 
    box-shadow:0 4px 10px rgba(37,99,235,.14); 
  }
  
  .btn-generate { 
    background:#4f46e5; 
    color:#fff;
    grid-column: 1 / -1;
  }
  
  .btn-reset { 
    background:#e5e7eb; 
    color:#374151; 
  }
  
  .btn-answer { 
    background:#16a34a; 
    color:#fff; 
  }
  
  .btn-print { 
    background:#111827; 
    color:#fff; 
  }

  input[type=number] {
    padding:10px;
    flex:1;
    border-radius:6px;
    border:1px solid #d1d5db;
    text-align:center;
    font-weight:700;
    font-size:14px;
  }

  .message { 
    text-align:center; 
    color:#9ca3af; 
    padding:40px 20px;
    font-size:14px;
  }

  .worksheet {
    width:100%;
    max-width:210mm;
    padding:15mm;
    margin:0 auto 18px;
    background:#fff;
    box-shadow:0 4px 10px rgba(0,0,0,.06);
    page-break-after:always;
    display:block;
  }

  .ws-header { text-align:center; margin-bottom:8px; }
  .ws-title { 
    font-size:24px; 
    font-weight:900; 
    padding-bottom:8px; 
    border-bottom:4px solid #e5e7eb; 
    display:inline-block; 
  }
  .day-num { 
    font-size:32px; 
    color:#f59e0b; 
    margin-right:8px; 
    font-family:serif; 
  }

  .ws-info {
    display:flex; 
    justify-content:space-between;
    margin-top:12px; 
    margin-bottom:8px; 
    gap:12px;
  }
  .info-group { display:flex; gap:8px; align-items:center; }
  .info-field {
    width:48px; 
    height:32px;
    border:1px solid #cbd5e1; 
    border-radius:6px;
    text-align:center; 
    font-weight:700;
  }

  .ws-content { 
    border-top:2px solid #000; 
    border-bottom:2px solid #000; 
    margin-top:8px; 
  }
  
  .columns { 
    display:grid; 
    grid-template-columns:1fr 1fr; 
  }

  .left-grid {
    display:grid; 
    grid-template-columns:1fr 1fr;
    grid-template-rows:repeat(5, 1fr);
    border-right:2px solid #000;
  }

  .problem-cell {
    padding:12px; 
    display:flex; 
    align-items:center; 
    justify-content:center;
    border-right:1px solid #e5e7eb; 
    border-bottom:1px solid #e5e7eb;
  }
  .problem-cell:nth-child(2n) { border-right:none; }
  .problem-cell:nth-child(n+9) { border-bottom:none; }

  .vertical-problem {
    font-family:monospace; 
    font-size:24px; 
    font-weight:800;
    display:flex; 
    flex-direction:column; 
    align-items:flex-end;
  }
  .vertical-problem .num1 { margin-bottom:6px; }
  .vertical-problem .op-row { 
    display:flex; 
    justify-content:flex-end; 
    gap:8px; 
    width:100%; 
  }
  .vertical-problem .op { margin-right:auto; padding-right:8px; }
  .line { width:100%; border-top:2px solid #000; margin-top:8px; }
  .answer-space { height:40px; }

  .right-list {
    display:grid; 
    grid-template-rows:repeat(10, 1fr);
    padding-left:12px;
  }
  
  .horizontal-problem {
    display:flex; 
    align-items:center; 
    padding-left:8px;
    font-family:monospace; 
    font-size:16px; 
    font-weight:700;
    border-bottom:1px solid #e5e7eb;
  }
  .horizontal-problem:last-child { border-bottom:none; }
  .horizontal-problem span { margin-right:8px; }
  .answer-box {
    width:80px; 
    height:32px;
    border:2px solid #d1d5db; 
    border-radius:6px;
    margin-left:8px;
  }

  .ws-footer { 
    text-align:center; 
    margin-top:8px; 
    color:#9ca3af; 
    font-weight:700; 
  }

  .answer-sheet {
    width:100%;
    max-width:210mm;
    padding:15mm;
    margin:0 auto 18px;
    background:#fff;
    box-shadow:0 4px 10px rgba(0,0,0,.06);
    page-break-after:always;
  }

  .answer-sheet h2 { 
    text-align:center; 
    margin-bottom:20px; 
  }

  .answer-day {
    margin-bottom:26px; 
    padding:12px;
    background:#fef3c7; 
    border-radius:8px;
  }

  .answer-line {
    font-size:16px; 
    font-weight:700;
    margin-bottom:8px;
    word-break:break-all;
  }

  /* ëª¨ë°”ì¼ ìµœì í™” */
  @media (max-width: 768px) {
    body {
      padding:8px;
    }
    
    .control {
      padding:12px;
    }
    
    .control-title {
      font-size:15px;
    }
    
    .btn {
      font-size:13px;
      padding:9px 12px;
    }
    
    .worksheet {
      padding:10mm;
    }
    
    .ws-title {
      font-size:20px;
    }
    
    .day-num {
      font-size:28px;
    }
    
    .vertical-problem {
      font-size:20px;
    }
    
    .horizontal-problem {
      font-size:14px;
    }
    
    .answer-box {
      width:70px;
      height:28px;
    }
    
    .answer-line {
      font-size:14px;
    }
  }
  
  @media (max-width: 480px) {
    .columns {
      grid-template-columns:1fr;
    }
    
    .left-grid {
      border-right:none;
      border-bottom:2px solid #000;
    }
    
    .right-list {
      padding-left:0;
      padding-top:12px;
    }
    
    .ws-title {
      font-size:18px;
    }
    
    .day-num {
      font-size:24px;
    }
    
    .info-field {
      width:40px;
      height:28px;
      font-size:12px;
    }
    
    .vertical-problem {
      font-size:18px;
    }
    
    .answer-space {
      height:32px;
    }
  }

  @media print {
    body { padding:0; background:white; }
    .control { display:none !important; }
    .worksheet, .answer-sheet { 
      box-shadow:none; 
      margin:0;
      width:210mm;
      min-height:297mm;
    }
    .columns {
      grid-template-columns:1fr 1fr !important;
    }
    .left-grid {
      border-right:2px solid #000 !important;
      border-bottom:none !important;
    }
    .right-list {
      padding-left:12px !important;
      padding-top:0 !important;
    }
    @page { size:A4; margin:0; }
  }
</style>
</head>

<body>
<div class="container">

  <div class="control">
    <span class="control-title">ğŸ§® ì•„ë¹ í‘œ ì—°ì‚° í•™ìŠµì§€ ë§Œë“¤ê¸° - ë”í•˜ê¸°/ë¹¼ê¸°</span>
    
    <div class="difficulty-section">
      <span class="difficulty-label">ë‚œì´ë„ ì„ íƒ</span>
      <div class="difficulty-buttons">
        <button class="btn btn-diff" id="btn-one">1ìë¦¬ìˆ˜</button>
        <button class="btn btn-diff active" id="btn-two">2ìë¦¬ìˆ˜</button>
        <button class="btn btn-diff" id="btn-three">3ìë¦¬ìˆ˜</button>
        <button class="btn btn-diff" id="btn-four">4ìë¦¬ìˆ˜</button>
        <button class="btn btn-diff" id="btn-3x2">3 x 2</button>
        <button class="btn btn-diff" id="btn-4x3">4 x 3</button>
      </div>
    </div>
    
    <div class="actions-section">
      <div class="input-group">
        <label>ìƒì„± ì¼ìˆ˜</label>
        <input id="numDays" type="number" min="1" max="30" value="1" />
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-generate" id="genBtn">âœ¨ ë¬¸ì œ ìƒì„±</button>
        <button class="btn btn-reset" id="resetBtn">â†» ì´ˆê¸°í™”</button>
        <button class="btn btn-answer" id="answerBtn" disabled>ğŸ“‹ ë‹µì•ˆì§€</button>
        <button class="btn btn-print" id="printBtn" disabled>ğŸ–¨ï¸ ì¸ì‡„</button>
      </div>
    </div>
  </div>

  <div id="printArea"></div>
  <div id="message" class="message">ë¬¸ì œë¥¼ ìƒì„±í•˜ë©´ ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>

</div>

<script>
(function(){
  let difficulty = 'two';
  let worksheets = [];
  let showAnswer = false;

  const ranges = {
    one: { min:1, max:9 },
    two: { min:10, max:99 },
    three: { min:100, max:999 },
    four: { min:1000, max:9999 },
    '3x2': { minA:100, maxA:999, minB:10, maxB:99 },
    '4x3': { minA:1000, maxA:9999, minB:100, maxB:999 }
  };

  function randomIn(r){ return Math.floor(Math.random()*(r.max-r.min+1))+r.min; }

  const btnOne = document.getElementById("btn-one");
  const btnTwo = document.getElementById("btn-two");
  const btnThree = document.getElementById("btn-three");
  const btnFour = document.getElementById("btn-four");
  const btn3x2 = document.getElementById("btn-3x2");
  const btn4x3 = document.getElementById("btn-4x3");

  const genBtn = document.getElementById("genBtn");
  const resetBtn = document.getElementById("resetBtn");
  const answerBtn = document.getElementById("answerBtn");
  const printBtn = document.getElementById("printBtn");
  const numDays = document.getElementById("numDays");

  const printArea = document.getElementById("printArea");
  const message = document.getElementById("message");

  function makeAB(difficulty, d) {
    if (difficulty === '3x2') {
      return {
        a: randomIn({ min: 100, max: 999 }),
        b: randomIn({ min: 10, max: 99 })
      };
    }
    if (difficulty === '4x3') {
      return {
        a: randomIn({ min: 1000, max: 9999 }),
        b: randomIn({ min: 100, max: 999 })
      };
    }
    return {
      a: randomIn(d),
      b: randomIn(d)
    };
  }

  function setDifficulty(d, el){
    difficulty = d;
    [btnOne, btnTwo, btnThree, btnFour, btn3x2, btn4x3].forEach(b => b.classList.remove("active"));
    el.classList.add("active");
  }

  btnOne.onclick = ()=> setDifficulty("one", btnOne);
  btnTwo.onclick = ()=> setDifficulty("two", btnTwo);
  btnThree.onclick = ()=> setDifficulty("three", btnThree);
  btnFour.onclick = () => setDifficulty("four", btnFour);
  btn3x2.onclick = () => setDifficulty("3x2", btn3x2);
  btn4x3.onclick = () => setDifficulty("4x3", btn4x3);

  genBtn.onclick = () => {
    const d = ranges[difficulty];
    const days = Math.min(30, Math.max(1, parseInt(numDays.value)||1));
    worksheets = [];

    for(let day=1; day<=days; day++){
      const add=[], sub=[];
      while(add.length<20){
        const { a, b } = makeAB(difficulty, d);
        if(a % 10 === b % 10) continue;
        if(a + b <= 9) continue;
        add.push({a, b});
      }

      function needsBorrow(a, b) {
        return (a % 10) < (b % 10);
      }

      const targetBorrowRatio = 0.75;

      while(sub.length < 20) {
        let { a, b } = makeAB(difficulty, d);
        if (a < b) [a, b] = [b, a];
        if (a % 10 === b % 10) continue;
        if (a - b <= 9) continue;

        const isBorrow = needsBorrow(a, b);
        const borrowCount = sub.filter(p => needsBorrow(p.a, p.b)).length;
        const currentRatio = borrowCount / (sub.length || 1);

        if (isBorrow && currentRatio < targetBorrowRatio) {
          sub.push({ a, b });
        } else if (!isBorrow && currentRatio >= targetBorrowRatio) {
          sub.push({ a, b });
        }
      }

      worksheets.push({ day, add, sub });
    }

    showAnswer = false;
    render();
    answerBtn.disabled = false;
    printBtn.disabled = false;
  };

  resetBtn.onclick = () => {
    worksheets=[];
    printArea.innerHTML="";
    message.style.display="block";
    answerBtn.disabled = true;
    printBtn.disabled = true;
  };

  answerBtn.onclick = () => {
    showAnswer=!showAnswer;
    render();
  };

  printBtn.onclick = () => window.print();

  function worksheetHTML(day, arr, op, title){
    const left = arr.slice(0,10);
    const right = arr.slice(10,20);

    let h=`
    <div class="worksheet">
      <div class="ws-header">
        <div class="ws-title"><span class="day-num">${day}</span>ì¼ì°¨ - ${title}</div>
      </div>

      <div class="ws-info">
        <div class="info-group">ğŸ“… <input class="info-field" placeholder="ì›”"><input class="info-field" placeholder="ì¼"></div>
        <div class="info-group">ğŸ• <input class="info-field" placeholder="ë¶„"><input class="info-field" placeholder="ì´ˆ"></div>
      </div>

      <div class="ws-content">
        <div class="columns">

          <div class="left-grid">`;

    left.forEach(p=>{
      h+=`
      <div class="problem-cell">
        <div class="vertical-problem">
          <div class="num1">${p.a}</div>
          <div class="op-row"><div class="op">${op}</div><div class="num2">${p.b}</div></div>
          <div class="line"></div>
          <div class="answer-space"></div>
        </div>
      </div>`;
    });

    for(let i=left.length;i<10;i++)
      h+=`<div class="problem-cell"></div>`;

    h+=`
          </div>

          <div class="right-list">`;

    right.forEach(p=>{
      h+=`
          <div class="horizontal-problem">
            <span>${p.a}</span><span>${op}</span><span>${p.b}</span><span>=</span>
            <div class="answer-box"></div>
          </div>`;
    });

    for(let i=right.length;i<10;i++)
      h+=`<div class="horizontal-problem"></div>`;

    h+=`
          </div>

        </div>
      </div>

      <div class="ws-footer">eddie math</div>
    </div>`;

    return h;
  }

  function makeAnswerBlock(label, problems) {
    const line1 = problems.slice(0,10).map((p,i)=>`${i+1}) ${p}`).join("   ");
    const line2 = problems.slice(10,20).map((p,i)=>`${i+11}) ${p}`).join("   ");

    return `
      <div class="answer-line"><strong>${label}</strong></div>
      <div class="answer-line">${line1}</div>
      <div class="answer-line">${line2}</div>
    `;
  }

  function answerHTML(){
    let h=`<div class="answer-sheet"><h2>ğŸ“‹ ì—°ì‚° ë‹µì•ˆì§€</h2>`;
    worksheets.forEach(ws=>{
      const addAns = ws.add.map(p=>p.a+p.b);
      const subAns = ws.sub.map(p=>p.a-p.b);

      h+=`
      <div class="answer-day">
        ${makeAnswerBlock(`ğŸŸ¦ ${ws.day}ì¼ì°¨ ë§ì…ˆ`, addAns)}
        <br>
        ${makeAnswerBlock(`ğŸŸ§ ${ws.day}ì¼ì°¨ ëº„ì…ˆ`, subAns)}
      </div>`;
    });
    h+=`</div>`;
    return h;
  }

  function render(){
    if(worksheets.length===0){
      message.style.display="block";
      printArea.innerHTML="";
      return;
    }
    message.style.display="none";

    if(showAnswer){
      printArea.innerHTML = answerHTML();
      return;
    }

    let out="";
    worksheets.forEach(ws=>{
      out+=worksheetHTML(ws.day, ws.add, "+", "ë§ì…ˆ");
      out+=worksheetHTML(ws.day, ws.sub, "âˆ’", "ëº„ì…ˆ");
    });
    printArea.innerHTML=out;
  }

})();
</script>

</body>
</html>